/* ===== Chat Page Layout ===== */
:root {
    /* Default Dark Theme Variables - HIGH CONTRAST */
    --bg-page: #020617;
    /* Very dark blue, almost black */
    --bg-header: #0f172a;
    /* Solid dark blue */
    --bg-input: #0f172a;
    --bg-input-field: #000000;
    /* Pure black input */

    --text-primary: #ffffff;
    /* Pure White */
    --text-secondary: #e2e8f0;
    /* Very light gray */
    --border-color: rgba(255, 255, 255, 0.2);

    /* Bubbles */
    --bubble-assistant-bg: #1e293b;
    /* Distinct dark slate */
    --bubble-assistant-text: #ffffff;
    --bubble-assistant-border: #334155;

    --bubble-user-bg: linear-gradient(135deg, #10b981 0%, #059669 100%);
    --bubble-user-text: #ffffff;

    /* Accents */
    --accent-color: #34d399;
    --accent-hover: #10b981;

    /* Font Sizes for Readability */
    --font-size-message: 1.125rem;
    /* 18px */
    --line-height-message: 1.6;
}

.light-mode {
    /* Light Theme Variables - HIGH CONTRAST */
    --bg-page: #ffffff;
    /* Pure White */
    --bg-header: #f8fafc;
    --bg-input: #f8fafc;
    --bg-input-field: #ffffff;

    --text-primary: #000000;
    /* Pure Black */
    --text-secondary: #0f172a;
    /* Dark Slate - high contrast */
    --border-color: #94a3b8;

    /* Bubbles */
    --bubble-assistant-bg: #f1f5f9;
    /* Very light gray */
    --bubble-assistant-text: #000000;
    /* Pure Black */
    --bubble-assistant-border: #cbd5e1;

    --bubble-user-bg: linear-gradient(135deg, #059669 0%, #047857 100%);
    /* Dark Green */
    --bubble-user-text: #ffffff;
}

.chat-page {
    display: flex;
    flex-direction: column;
    height: 100vh;
    background: var(--bg-page);
    color: var(--text-primary);
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    transition: background-color 0.3s, color 0.3s;
}

/* ===== Consent Modal ===== */
.consent-overlay {
    position: fixed;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(8px);
    padding: 1rem;
    z-index: 100;
}

.consent-modal {
    background: var(--bg-header);
    /* Reusing header variable for modal bg-like effect */
    background-color: var(--bg-page);
    /* Better ensuring contrast */
    border: 1px solid var(--border-color);
    border-radius: 24px;
    padding: 2.5rem;
    max-width: 480px;
    width: 100%;
    text-align: center;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
}

/* Light mode specific fix for modal background since it relies on solid color */
.light-mode .consent-modal {
    background-color: #ffffff;
    border: 1px solid #e2e8f0;
}

.light-mode .consent-overlay {
    background: rgba(0, 0, 0, 0.3);
}

.consent-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.consent-modal h2 {
    font-size: 1.5rem;
    margin-bottom: 1rem;
    color: var(--text-primary);
}

.consent-modal>p {
    color: var(--text-secondary);
    margin-bottom: 1.5rem;
    line-height: 1.6;
}

.consent-list {
    text-align: left;
    list-style: none;
    padding: 0;
    margin: 0 0 2rem 0;
}

.consent-list li {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 0.75rem 0;
    border-bottom: 1px solid var(--border-color);
    color: var(--text-secondary);
    font-size: 0.95rem;
}

.consent-list li:last-child {
    border-bottom: none;
}

.consent-check {
    color: var(--accent-color);
    font-weight: bold;
    flex-shrink: 0;
}

.consent-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
}

.consent-actions .btn {
    flex: 1;
    padding: 0.875rem 1.5rem;
    border-radius: 12px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    border: none;
}

.consent-actions .btn-secondary {
    background: var(--border-color);
    color: var(--text-secondary);
}

.consent-actions .btn-secondary:hover {
    filter: brightness(0.95);
}

.consent-actions .btn-primary {
    background: var(--bubble-user-bg);
    color: white;
}

.consent-actions .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
}

/* ===== Chat Header ===== */
.chat-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 1rem 1.5rem;
    background: var(--bg-header);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border-color);
    position: sticky;
    top: 0;
    z-index: 10;
    transition: background-color 0.3s;
}

.back-button {
    background: transparent;
    border: 1px solid var(--border-color);
    color: var(--text-secondary);
    padding: 0.5rem 1rem;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.875rem;
    transition: all 0.2s;
}

.back-button:hover {
    background: var(--border-color);
    color: var(--text-primary);
}

.theme-toggle {
    background: transparent;
    border: 1px solid var(--border-color);
    color: var(--text-primary);
    width: 36px;
    height: 36px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    transition: all 0.2s;
    margin-left: 0.5rem;
}

.theme-toggle:hover {
    background: var(--border-color);
}

.chat-title {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.chat-icon {
    font-size: 1.5rem;
}

.chat-title h1 {
    font-size: 1.25rem;
    font-weight: 700;
    margin: 0;
    color: var(--text-primary);
    letter-spacing: -0.025em;
}

.chat-status {
    font-size: 0.85rem;
    color: var(--accent-color);
    font-weight: 500;
}

.header-spacer {
    width: 80px;
    /* Adjust if needed to balance header */
}

/* ===== Messages Area ===== */
.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 1.5rem;
    scroll-behavior: smooth;
}

.messages-container {
    max-width: 800px;
    margin: 0 auto;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    /* Increased gap for better readability separation */
}

/* ===== Message Bubbles ===== */
.message {
    display: flex;
    gap: 1rem;
    animation: fadeInUp 0.3s ease-out;
}

@keyframes fadeInUp {
    from {
        opacity: 0;
        transform: translateY(10px);
    }

    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.message-user {
    flex-direction: row-reverse;
}

.message-avatar {
    width: 42px;
    height: 42px;
    border-radius: 12px;
    /* Softer square looks more modern */
    background: linear-gradient(135deg, #10b981 0%, #059669 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    flex-shrink: 0;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.message-content {
    max-width: 75%;
    padding: 1.25rem 1.5rem;
    border-radius: 20px;
    position: relative;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    /* Subtle depth */
}

.message-assistant .message-content {
    background: var(--bubble-assistant-bg);
    color: var(--bubble-assistant-text);
    border: 1px solid var(--bubble-assistant-border);
    border-bottom-left-radius: 4px;
}

.message-user .message-content {
    background: var(--bubble-user-bg);
    color: var(--bubble-user-text);
    border-bottom-right-radius: 4px;
    box-shadow: 0 4px 10px rgba(16, 185, 129, 0.2);
}

.message-content p {
    margin: 0;
    line-height: var(--line-height-message);
    white-space: pre-wrap;
    font-size: var(--font-size-message);
    font-weight: 400;
    color: inherit;
    /* Fix: Override global p style from index.css */
}

.message-time {
    display: block;
    font-size: 0.75rem;
    color: var(--text-secondary);
    margin-top: 0.5rem;
    opacity: 0.8;
}

.message-user .message-time {
    color: var(--text-secondary);
    /* User time can also be secondary text outside bubble, or light if inside. Here it is inside container but usually outside bubble is better for contrast. Current structure puts it inside message-content div? No, checking TSX... it is inside. */
}

/* Fix: Time should be readable on user bubble */
.message-user .message-time {
    color: rgba(255, 255, 255, 0.9);
    text-align: right;
}

/* ===== Typing Indicator ===== */
.typing-indicator {
    display: flex;
    gap: 6px;
    padding: 1.25rem 1.5rem;
    align-items: center;
}

.typing-indicator span {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--text-secondary);
    animation: typing 1.4s infinite;
}

.typing-indicator span:nth-child(2) {
    animation-delay: 0.2s;
}

.typing-indicator span:nth-child(3) {
    animation-delay: 0.4s;
}

@keyframes typing {

    0%,
    60%,
    100% {
        transform: translateY(0);
        opacity: 0.4;
    }

    30% {
        transform: translateY(-6px);
        opacity: 1;
    }
}

/* ===== Error Message ===== */
.error-message {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background: rgba(239, 68, 68, 0.1);
    border: 1px solid rgba(239, 68, 68, 0.3);
    border-radius: 12px;
    color: #fca5a5;
    margin-bottom: 1rem;
}

.light-mode .error-message {
    background: #fef2f2;
    border-color: #fecaca;
    color: #ef4444;
}

.error-message span {
    font-size: 1.25rem;
}

.error-message button {
    background: rgba(239, 68, 68, 0.2);
    border: none;
    color: inherit;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.875rem;
}

/* ===== Input Area ===== */
.chat-input-container {
    padding: 1.5rem;
    background: var(--bg-input);
    backdrop-filter: blur(10px);
    border-top: 1px solid var(--border-color);
}

.chat-input-wrapper {
    max-width: 800px;
    margin: 0 auto;
    display: flex;
    gap: 1rem;
    align-items: flex-end;
}

.chat-input {
    flex: 1;
    background: var(--bg-input-field);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    padding: 1rem 1.25rem;
    color: var(--text-primary);
    font-size: 1rem;
    resize: none;
    min-height: 56px;
    max-height: 150px;
    font-family: inherit;
    line-height: 1.5;
    transition: all 0.2s;
}

.chat-input:focus {
    outline: none;
    border-color: #10b981;
}

.chat-input::placeholder {
    color: var(--text-secondary);
}

.send-button {
    width: 56px;
    height: 56px;
    border-radius: 16px;
    /* Matching input curvature */
    background: var(--bubble-user-bg);
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
    flex-shrink: 0;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

/* ===== Responsive ===== */
@media (max-width: 640px) {
    :root {
        --font-size-message: 1rem;
    }

    .consent-modal {
        padding: 1.5rem;
        border-radius: 20px;
    }

    .consent-actions {
        flex-direction: column;
    }

    .message-content {
        max-width: 85%;
        padding: 1rem;
    }

    .chat-header {
        padding: 0.75rem 1rem;
    }

    .chat-messages {
        padding: 1rem;
    }

    .chat-input-container {
        padding: 1rem;
    }
}